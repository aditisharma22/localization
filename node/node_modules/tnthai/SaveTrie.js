fs = require('fs')
doublearray = require("doublearray")

fs.readFile('./WordAspects.json', function read(err, data) {
    if (err) {
        throw err;
    }
    var words = [];
    
    content = JSON.parse(data);
    for(i = 0 ;i < content.length; i++){
        words.push({ k: content[i]['WordAspect'], v: 1 })
    }

    var trie = doublearray.builder().build(words);
    
    console.log(trie.contain('กรีนิช'));  // -> true
    
    console.log(trie.lookup('ไทยแลนด์'));  // -> 2
    
    console.log(trie.commonPrefixSearch('คนแก่ขนของ'));

    var base_buffer = trie.bc.getBaseBuffer();
    var check_buffer = trie.bc.getCheckBuffer();

    console.log(typeof base_buffer)
    console.log(typeof check_buffer)
    console.log(base_buffer.constructor)
    console.log(check_buffer.constructor)
    console.log(base_buffer.length)
    console.log(check_buffer.length)
    console.log("before")
    for(i = 0 ;i<10; i ++)
        console.log(base_buffer[i])

    a = base_buffer.toString()
    base_buffer = new Int32Array(a.split(","))
    console.log("after")
    for(i = 0 ;i<10; i ++)
        console.log(base_buffer[i])

    console.log(typeof base_buffer)
    console.log(typeof check_buffer)
    console.log(base_buffer.constructor)
    console.log(check_buffer.constructor)
    console.log(base_buffer.length)
    console.log(check_buffer.length)
    fs.writeFile("bb", base_buffer.toString(), function (err) {console.log("finish bb")})
    fs.writeFile("cb", check_buffer.toString(), function (err) {console.log("finish cb")})

    var loaded_trie = doublearray.load(base_buffer.slice(), check_buffer.slice());
    
    console.log(loaded_trie.contain('กรีนิช'));  // -> true
    
    console.log(loaded_trie.lookup('ไทยแลนด์'));  // -> 2
    
    console.log(loaded_trie.commonPrefixSearch('คนแก่ขนของ'));
    

});
